<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIPLAY - VIETSUB KHÔNG QUẢNG CÁO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --dark: #2d3436;
            --light: #f5f6fa;
            --accent: #fd79a8;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            display: grid;
            grid-template-columns: 80px 1fr 300px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
            position: fixed;
            height: 100vh;
            width: 80px;
            transition: width 0.3s ease;
        }

        .sidebar:hover {
            width: 220px;
            align-items: flex-start;
            padding-left: 20px;
        }

        .sidebar:hover .nav-item span {
            display: inline;
        }

        .logo {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .logo span {
            font-weight: bold;
            font-size: 1.2rem;
            display: none;
        }

        .nav {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 5px;
        }

        .nav-item {
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--light);
        }

        .nav-item:hover {
            background-color: var(--primary);
        }

        .nav-item.active {
            background-color: var(--primary);
        }

        .nav-item i {
            font-size: 1.2rem;
            min-width: 24px;
        }

        .nav-item span {
            display: none;
            white-space: nowrap;
        }

        .user {
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }

        .user:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            display: none;
        }

        .sidebar:hover .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: bold;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Main content */
        .main {
            grid-column: 2;
            padding: 20px;
            padding-left: 100px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 15px;
            width: 300px;
        }

        .search-bar i {
            margin-right: 10px;
            opacity: 0.7;
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            outline: none;
            width: 100%;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification {
            position: relative;
            cursor: pointer;
        }

        .notification i {
            font-size: 1.2rem;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary);
        }

        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .anime-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .anime-poster {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .anime-info {
            padding: 15px;
        }

        .anime-title {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .anime-episodes {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .anime-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Anime detail modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: var(--dark);
            margin: 50px auto;
            max-width: 900px;
            border-radius: 10px;
            overflow: hidden;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .close-modal:hover {
            transform: rotate(90deg);
            color: var(--accent);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .anime-detail {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .anime-detail-poster {
            width: 250px;
            height: 350px;
            object-fit: cover;
            border-radius: 5px;
        }

        .anime-detail-info {
            flex: 1;
        }

        .anime-detail-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .anime-detail-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .anime-detail-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .episodes-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .episode-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .episode-card:hover {
            background-color: var(--primary);
        }

        .episode-number {
            font-weight: bold;
        }

        .player-container {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: black;
            margin-top: 20px;
            border-radius: 5px;
            overflow: hidden;
        }

        /* Right sidebar */
        .right-sidebar {
            grid-column: 3;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trending-anime {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .trending-item {
            display: flex;
            gap: 10px;
            align-items: center;
            cursor: pointer;
        }

        .trending-rank {
            font-weight: bold;
            color: var(--primary);
            width: 20px;
        }

        .trending-poster {
            width: 50px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
        }

        .trending-info {
            flex: 1;
        }

        .trending-title {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .trending-episodes {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Loading animation */
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            body {
                grid-template-columns: 80px 1fr;
            }
            .right-sidebar {
                display: none;
            }
            .main {
                padding-right: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                display: flex;
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                padding: 10px;
                position: relative;
            }
            .sidebar:hover {
                width: 100%;
                padding: 10px;
            }
            .logo {
                margin-bottom: 0;
            }
            .nav {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            .nav-item {
                padding: 8px 12px;
            }
            .user {
                margin-top: 0;
                margin-left: auto;
            }
            .main {
                padding: 20px;
                margin-top: 60px;
            }
            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            .search-bar {
                width: 100%;
            }
            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            .anime-detail {
                flex-direction: column;
            }
            .anime-detail-poster {
                width: 100%;
                height: auto;
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="https://raw.githubusercontent.com/niyakipham/niyakipham.github.io/refs/heads/main/assets/kaguya.jpeg" alt="Logo">
            <span>ANIPLAY</span>
        </div>
        <nav class="nav">
            <a href="#" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Trang chủ</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-fire"></i>
                <span>Trending</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-bookmark"></i>
                <span>Yêu thích</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-history"></i>
                <span>Lịch sử</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>Cài đặt</span>
            </a>
        </nav>
        <div class="user">
            <img src="https://raw.githubusercontent.com/niyakipham/niyakipham.github.io/refs/heads/main/assets/kaguya.jpeg" alt="User Avatar">
            <div class="user-info">
                <span class="user-name">ADMIN</span>
                <span class="user-role">Premium</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="header">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Tìm kiếm anime...">
            </div>
            <div class="user-actions">
                <div class="notification">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
                
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-star"></i>
                Anime mới cập nhật
            </h2>
            <div class="anime-grid" id="animeGrid">
                <!-- Anime cards will be loaded here -->
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">
                <i class="fas fa-fire"></i>
                Anime phổ biến
            </h2>
            <div class="anime-grid" id="popularAnimeGrid">
                <!-- Popular anime will be loaded here -->
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Sidebar -->
    <div class="right-sidebar">
        <div class="sidebar-section">
            <h3 class="sidebar-title">
                <i class="fas fa-chart-line"></i>
                Top Trending
            </h3>
            <div class="trending-anime" id="trendingAnime">
                <!-- Trending anime will be loaded here -->
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <h3 class="sidebar-title">
                <i class="fas fa-clock"></i>
                Gần đây
            </h3>
            <div class="trending-anime" id="recentAnime">
                <!-- Recent anime will be loaded here -->
                <div class="loader">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Anime Detail Modal -->
    <div class="modal" id="animeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Anime Title</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="anime-detail">
                    <img src="https://via.placeholder.com/250x350" alt="Anime Poster" class="anime-detail-poster" id="detailPoster">
                    <div class="anime-detail-info">
                        <h1 class="anime-detail-title" id="detailTitle">Anime Title</h1>
                        <div class="anime-detail-meta">
                            <span id="detailEpisodes">12 tập</span>
                            <span id="detailStatus">Đang phát</span>
                            <span id="detailYear">2023</span>
                        </div>
                        <p class="anime-detail-description" id="detailDescription">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in dui mauris. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor.
                        </p>
                    </div>
                </div>

                <h3 class="section-title">
                    <i class="fas fa-list"></i>
                    Danh sách tập
                </h3>
                <div class="episodes-list" id="episodesList">
                    <!-- Episodes will be loaded here -->
                </div>

                <div class="player-container" id="playerContainer">
                    <iframe id="videoPlayer" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let animeData = [];
        let groupedAnime = {};
        let currentAnime = null;

        // DOM elements
        const animeGrid = document.getElementById('animeGrid');
        const popularAnimeGrid = document.getElementById('popularAnimeGrid');
        const trendingAnime = document.getElementById('trendingAnime');
        const recentAnime = document.getElementById('recentAnime');
        const animeModal = document.getElementById('animeModal');
        const modalTitle = document.getElementById('modalTitle');
        const detailTitle = document.getElementById('detailTitle');
        const detailPoster = document.getElementById('detailPoster');
        const detailEpisodes = document.getElementById('detailEpisodes');
        const detailStatus = document.getElementById('detailStatus');
        const detailYear = document.getElementById('detailYear');
        const detailDescription = document.getElementById('detailDescription');
        const episodesList = document.getElementById('episodesList');
        const videoPlayer = document.getElementById('videoPlayer');
        const playerContainer = document.getElementById('playerContainer');
        const closeModal = document.querySelector('.close-modal');

        // Fetch anime data from GitHub
        async function fetchAnimeData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/yushichivnllc/sxhas/refs/heads/main/anime.csv');
                const csvData = await response.text();
                parseCSVData(csvData);
            } catch (error) {
                console.error('Error fetching anime data:', error);
                animeGrid.innerHTML = '<p>Không thể tải dữ liệu anime. Vui lòng thử lại sau.</p>';
            }
        }

        // Parse CSV data and group by anime name
        function parseCSVData(csvData) {
            const lines = csvData.split('\n');
            animeData = [];
            
            // Skip header row
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Simple CSV parsing (won't handle commas in quoted fields)
                const [name, episodes, link] = line.split(',');
                
                if (name && episodes && link) {
                    animeData.push({
                        name: name.replace(/"/g, '').trim(),
                        episodes: episodes.replace(/"/g, '').trim(),
                        link: link.replace(/"/g, '').trim()
                    });
                }
            }
            
            // Group anime by name
            groupedAnime = {};
            animeData.forEach(item => {
                if (!groupedAnime[item.name]) {
                    groupedAnime[item.name] = [];
                }
                groupedAnime[item.name].push(item);
            });
            
            renderAnime();
        }

        // Render anime to the grid
        function renderAnime() {
            animeGrid.innerHTML = '';
            popularAnimeGrid.innerHTML = '';
            trendingAnime.innerHTML = '';
            recentAnime.innerHTML = '';
            
            // Create arrays for different sections
            const allAnime = Object.keys(groupedAnime);
            const popularAnime = [...allAnime].sort((a, b) => groupedAnime[b].length - groupedAnime[a].length).slice(0, 6);
            const trendingAnimeList = [...allAnime].sort(() => 0.5 - Math.random()).slice(0, 5);
            const recentAnimeList = [...allAnime].slice(0, 5);
            
            // Render all anime
            allAnime.forEach(name => {
                const anime = groupedAnime[name];
                animeGrid.appendChild(createAnimeCard(name, anime));
            });
            
            // Render popular anime
            popularAnime.forEach(name => {
                const anime = groupedAnime[name];
                popularAnimeGrid.appendChild(createAnimeCard(name, anime));
            });
            
            // Render trending anime
            trendingAnimeList.forEach((name, index) => {
                const anime = groupedAnime[name];
                trendingAnime.appendChild(createTrendingItem(name, anime, index + 1));
            });
            
            // Render recent anime
            recentAnimeList.forEach((name, index) => {
                const anime = groupedAnime[name];
                recentAnime.appendChild(createTrendingItem(name, anime));
            });
        }

        // Create anime card element
        function createAnimeCard(name, episodes) {
            const card = document.createElement('div');
            card.className = 'anime-card';
            
            // Generate a consistent color based on anime name
            const colors = ['#6c5ce7', '#00b894', '#fd79a8', '#fdcb6e', '#e17055', '#0984e3'];
            const colorIndex = name.charCodeAt(0) % colors.length;
            const bgColor = colors[colorIndex];
            
            card.innerHTML = `
                <div style="background-color: ${bgColor}; height: 250px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-play" style="font-size: 3rem; opacity: 0.7;"></i>
                </div>
                <div class="anime-info">
                    <h3 class="anime-title">${name}</h3>
                    <p class="anime-episodes">${episodes.length} tập</p>
                </div>
                <div class="anime-badge">New</div>
            `;
            
            card.addEventListener('click', () => openAnimeModal(name));
            return card;
        }

        // Create trending anime item
        function createTrendingItem(name, episodes, rank = null) {
            const item = document.createElement('div');
            item.className = 'trending-item';
            
            // Generate a consistent color based on anime name
            const colors = ['#6c5ce7', '#00b894', '#fd79a8', '#fdcb6e', '#e17055', '#0984e3'];
            const colorIndex = name.charCodeAt(0) % colors.length;
            const bgColor = colors[colorIndex];
            
            item.innerHTML = `
                ${rank ? `<span class="trending-rank">${rank}</span>` : ''}
                <div style="background-color: ${bgColor}; width: 50px; height: 70px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-play" style="font-size: 1.5rem; opacity: 0.7;"></i>
                </div>
                <div class="trending-info">
                    <h4 class="trending-title">${name}</h4>
                    <p class="trending-episodes">${episodes.length} tập</p>
                </div>
            `;
            
            item.addEventListener('click', () => openAnimeModal(name));
            return item;
        }

        // Open anime modal with details
        function openAnimeModal(name) {
            currentAnime = name;
            const episodes = groupedAnime[name];
            
            // Set modal title
            modalTitle.textContent = name;
            detailTitle.textContent = name;
            
            // Set anime details
            detailEpisodes.textContent = `${episodes.length} tập`;
            detailStatus.textContent = 'Đang phát';
            
            // Generate a random year between 2015-2023
            const randomYear = 2015 + Math.floor(Math.random() * 9);
            detailYear.textContent = randomYear;
            
            // Generate a placeholder description
            detailDescription.textContent = `"${name}" là một bộ anime hấp dẫn với cốt truyện đặc sắc và hình ảnh đẹp mắt. Bộ phim đã nhận được nhiều đánh giá tích cực từ khán giả và các nhà phê bình.`;
            
            // Generate a consistent color based on anime name
            const colors = ['#6c5ce7', '#00b894', '#fd79a8', '#fdcb6e', '#e17055', '#0984e3'];
            const colorIndex = name.charCodeAt(0) % colors.length;
            const bgColor = colors[colorIndex];
            
            // Set placeholder poster with colored background
            detailPoster.style.backgroundColor = bgColor;
            detailPoster.innerHTML = '<i class="fas fa-play" style="font-size: 3rem; opacity: 0.7;"></i>';
            
            // Render episodes
            episodesList.innerHTML = '';
            episodes.forEach(ep => {
                const episodeCard = document.createElement('div');
                episodeCard.className = 'episode-card';
                episodeCard.innerHTML = `
                    <div class="episode-number">Tập ${ep.episodes}</div>
                `;
                
                episodeCard.addEventListener('click', () => playEpisode(ep.link));
                episodesList.appendChild(episodeCard);
            });
            
            // Hide player initially
            playerContainer.style.display = 'none';
            
            // Show modal
            animeModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Play episode in iframe
        function playEpisode(link) {
            // Show player
            playerContainer.style.display = 'block';
            
            // Convert Google Drive link to embeddable format if needed
            let embedUrl = link;
            if (link.includes('drive.google.com')) {
                const fileId = link.match(/\/file\/d\/([^\/]+)/)[1];
                embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            }
            
            // Set iframe source
            videoPlayer.src = embedUrl;
            
            // Scroll to player
            playerContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // Close modal
        function closeAnimeModal() {
            animeModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            videoPlayer.src = '';
        }

        // Event listeners
        closeModal.addEventListener('click', closeAnimeModal);
        window.addEventListener('click', (e) => {
            if (e.target === animeModal) {
                closeAnimeModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', fetchAnimeData);

        // Poll for updates every 5 minutes
        setInterval(fetchAnimeData, 5 * 60 * 1000);
    </script>
</body>
</html>
