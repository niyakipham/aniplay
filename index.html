<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIPLAY ✨ Your Universe of Anime</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        :root {
            --primary: #818cf8; /* indigo-400 */
            --primary-glow: #4f46e5; /* indigo-700 */
            --secondary: #67e8f9; /* cyan-300 */

            --dark-bg: #0F1020;
            --dark-card: #181A2F;
            --dark-card-secondary: #222543;
            --dark-text: #E0E1FF;
            --dark-text-muted: #9194bb;
            --dark-border: #2A2E59;
            --dark-border-hover: var(--primary);

            --light-bg: #F5F5F9;
            --light-card: #FFFFFF;
            --light-card-secondary: #F0F0F8;
            --light-text: #111827;
            --light-text-muted: #6b7280;
            --light-border: #e2e8f0;
            --light-border-hover: var(--primary);
        }

        .dark {
            --bg-color: var(--dark-bg);
            --card-color: var(--dark-card);
            --card-color-secondary: var(--dark-card-secondary);
            --text-color: var(--dark-text);
            --text-color-muted: var(--dark-text-muted);
            --border-color: var(--dark-border);
            --border-color-hover: var(--dark-border-hover);
        }

        .light {
            --bg-color: var(--light-bg);
            --card-color: var(--light-card);
            --card-color-secondary: var(--light-card-secondary);
            --text-color: var(--light-text);
            --text-color-muted: var(--light-text-muted);
            --border-color: var(--light-border);
            --border-color-hover: var(--light-border-hover);
        }

        body, html {
            scroll-behavior: smooth;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            z-index: -1;
            width: 100%;
            height: 100vh;
            background-color: var(--dark-bg);
            background-image:
                linear-gradient(var(--dark-border) 1px, transparent 1px),
                linear-gradient(to right, var(--dark-border) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.1;
        }
        
        .light .bg-grid {
             background-color: var(--light-bg);
             background-image:
                linear-gradient(var(--light-border) 1px, transparent 1px),
                linear-gradient(to right, var(--light-border) 1px, transparent 1px);
            opacity: 0.4;
        }

        .aurora {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
            mix-blend-mode: soft-light;
        }
        
        .aurora__item {
            position: absolute;
            height: 80vh;
            width: 80vh;
            border-radius: 50%;
            opacity: 0.3;
            filter: blur(80px);
            transition: all 0.3s ease;
        }

        .dark .aurora__item { opacity: 0.2; }
        
        .aurora__item:nth-of-type(1) {
            top: 0;
            right: 0;
            background-image: radial-gradient(circle at center, #8a45fe 0%, #351f7d 80%);
            animation: move-aurora-1 25s infinite linear;
        }

        .aurora__item:nth-of-type(2) {
            top: 30vh;
            left: 50%;
            background-image: radial-gradient(circle at center, #00d2f8 0%, #001287 80%);
            animation: move-aurora-2 20s infinite linear;
        }

        .aurora__item:nth-of-type(3) {
            bottom: -30vh;
            left: 0;
            background-image: radial-gradient(circle at center, #3553ff 0%, #2f254b 80%);
             animation: move-aurora-3 30s infinite linear;
        }


        @keyframes move-aurora-1 {
            0% { transform: translate(-30%, -10%); }
            50% { transform: translate(15%, 20%); }
            100% { transform: translate(-30%, -10%); }
        }
        
        @keyframes move-aurora-2 {
            0% { transform: translate(10%, 20%); }
            50% { transform: translate(-30%, -15%); }
            100% { transform: translate(10%, 20%); }
        }
        @keyframes move-aurora-3 {
            0% { transform: translate(20%, 0%); }
            50% { transform: translate(-10%, 25%); }
            100% { transform: translate(20%, 0%); }
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.05);
            -webkit-backdrop-filter: blur(16px);
            backdrop-filter: blur(16px);
            border: 1px solid var(--dark-border);
        }

        .light .glassmorphism {
             background: rgba(255, 255, 255, 0.4);
             border-color: var(--light-border-hover);
        }

        #site-header.scrolled .glassmorphism {
             border-color: transparent;
             border-bottom: 1px solid var(--dark-border);
             box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .light #site-header.scrolled .glassmorphism {
             border-bottom-color: var(--light-border);
             box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .fancy-button {
            position: relative;
            background-image: linear-gradient(135deg, var(--primary) 0%, #4f46e5 100%);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .15);
        }

        .fancy-button::before,
        .fancy-button::after {
            content: '';
            position: absolute;
            left: -2px;
            top: -2px;
            background: linear-gradient(45deg, var(--primary), var(--primary-glow), var(--secondary), var(--primary), var(--secondary));
            background-size: 400%;
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            z-index: -1;
            animation: steam 20s linear infinite;
            border-radius: 0.5rem;
        }

        .fancy-button::after {
            filter: blur(50px);
        }
        @keyframes steam {
            0% { background-position: 0 0; }
            50% { background-position: 400% 0; }
            100% { background-position: 0 0; }
        }
        

        .theme-toggle-button {
            --bar-color: var(--text-color);
            color: var(--bar-color);
            background-color: var(--bg-color);
        }
        .theme-toggle-button.toggled {
            background-color: var(--card-color-secondary);
        }
        .light .theme-toggle-button.toggled {
            background-color: var(--bg-color);
        }

        .anime-card-dynamic {
            border: 1px solid var(--border-color);
            background: linear-gradient(var(--card-color), var(--card-color)) padding-box,
                        linear-gradient(145deg, transparent 35%, var(--primary), var(--secondary)) border-box;
            background-color: var(--card-color);
        }

        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .scroll-reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .episode-button-glow {
            position: relative;
            z-index: 1;
        }

        .episode-button-glow:hover {
            border-color: var(--primary);
            box-shadow: 0 0 10px 0 var(--primary);
        }

        .episode-button-glow::before {
            content: "";
            z-index: -1;
            position: absolute;
            inset: 0;
            background-color: var(--card-color);
            border-radius: inherit;
        }

         .episode-button-glow.active {
            border-color: var(--primary);
        }

         .episode-button-glow.active::before {
             background-color: color-mix(in srgb, var(--primary) 10%, transparent);
        }
    </style>
</head>

<body class="transition-colors duration-500 ease-in-out">
    <div class="bg-grid"></div>
    <div class="aurora">
        <div class="aurora__item"></div>
        <div class="aurora__item"></div>
        <div class="aurora__item"></div>
    </div>
    
    <header id="site-header" class="sticky top-0 z-40 w-full transition-all duration-300">
        <div class="px-6 py-4 glassmorphism">
            <div class="mx-auto flex w-full max-w-7xl items-center justify-between">
                <a href="#" class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <defs>
                            <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color: var(--primary-glow);"></stop>
                                <stop offset="100%" style="stop-color: var(--secondary);"></stop>
                            </linearGradient>
                        </defs>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" stroke="url(#logo-gradient)" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" stroke="url(#logo-gradient)" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h1 class="text-2xl font-black bg-gradient-to-r from-[var(--primary)] to-[var(--secondary)] bg-clip-text text-transparent tracking-tighter">ANIPLAY</h1>
                </a>
                
                <div class="flex items-center gap-6">
                    <label class="relative flex items-center">
                        <input id="theme-toggle" type="checkbox" class="peer/toggle sr-only">
                        <button class="relative rounded-full border border-[var(--border-color)] p-1.5 peer-focus-visible/toggle:outline peer-focus-visible/toggle:outline-2 peer-focus-visible/toggle:outline-[var(--primary-glow)] transition-all theme-toggle-button">
                           <svg class="h-4 w-4 stroke-current dark:opacity-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 12a5 5 0 110-10a5 5 0 010 10z"></path></svg>
                           <svg class="h-4 w-4 stroke-current absolute inset-1.5 opacity-0 dark:opacity-100" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646a9.003 9.003 0 0011.708 11.708z"></path></svg>
                        </button>
                    </label>

                    <button id="refresh-btn" class="fancy-button font-bold text-white rounded-lg px-5 py-2.5 text-center text-sm transition-transform duration-300 hover:scale-105 active:scale-95">
                        <span>
                            <i class="fa-solid fa-arrows-rotate mr-2"></i>Cập Nhật
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </header>


    <main class="w-full max-w-7xl mx-auto px-6 py-12">
        <div class="grid lg:grid-cols-3 gap-8">
           
            <div class="lg:col-span-1 space-y-6">
                <div id="anime-list-section" class="scroll-reveal p-6 border-b-2 rounded-xl border-[var(--dark-border-hover)] bg-[var(--card-color)] transition-all">
                    <div class="flex items-center justify-between mb-5">
                        <h2 class="text-xl font-bold tracking-tight text-[var(--text-color)] flex items-center gap-3">
                           <i class="fa-solid fa-list text-[var(--primary-glow)]"></i> Danh sách Anime
                        </h2>
                         <span id="anime-count" class="font-semibold text-xs py-1 px-3 bg-[var(--card-color-secondary)] text-[var(--text-color)] rounded-full">0</span>
                    </div>

                    <div class="relative">
                       <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-search text-[var(--text-color-muted)]"></i>
                        </span>
                        <input type="text" id="search-anime" placeholder="Tìm kiếm anime của bạn..." class="w-full pl-10 pr-4 py-3 bg-[var(--card-color-secondary)] border border-[var(--border-color)] rounded-xl focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition duration-300">
                    </div>
                    
                    <div id="anime-list-container" class="mt-4 pr-1 max-h-[60vh] overflow-y-auto">
                        <div id="loading-anime" class="flex justify-center items-center py-10 space-x-2">
                             <div class="dot animate-loader-dot" style="animation-delay: 0s;"></div>
                             <div class="dot animate-loader-dot" style="animation-delay: 0.1s;"></div>
                             <div class="dot animate-loader-dot" style="animation-delay: 0.2s;"></div>
                         </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2">
                 <div id="main-content-area" class="bg-[var(--card-color)] scroll-reveal rounded-xl border border-[var(--border-color)]">
                    
                    <div id="selected-anime-info" class="p-6 border-b border-[var(--border-color)] hidden">
                        <div class="flex items-center gap-4">
                            <div class="h-20 w-20 flex-shrink-0 bg-gradient-to-br from-[var(--primary)] to-[var(--primary-glow)] rounded-2xl flex items-center justify-center">
                               <i class="fa-solid fa-film text-white text-3xl"></i>
                            </div>
                            <div>
                                <h2 id="selected-anime-title" class="text-2xl lg:text-3xl font-extrabold tracking-tighter text-[var(--text-color)]"></h2>
                                 <div id="selected-anime-meta" class="flex items-center space-x-3 text-sm text-[var(--text-color-muted)] mt-1">
                                    <span class="flex items-center gap-1.5"><i class="fas fa-list-ol"></i> <span id="episode-count">0</span> Episodes</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="episode-container" class="p-6 hidden">
                         <div id="episode-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3"></div>
                    </div>

                    <div id="player-container" class="px-6 pb-6 hidden">
                        <div class="aspect-w-16 aspect-h-9 bg-[var(--bg-color)] rounded-lg overflow-hidden ring-1 ring-[var(--border-color)]">
                            <iframe id="video-player" class="w-full h-[30rem] lg:h-[36rem]" frameborder="0" allowfullscreen allow="autoplay; encrypted-media"></iframe>
                        </div>
                    </div>

                    <div id="empty-state" class="p-10 flex flex-col items-center justify-center text-center">
                         <div class="w-24 h-24 mb-6 rounded-full bg-[var(--card-color-secondary)] flex items-center justify-center">
                             <i class="fas fa-paper-plane text-4xl text-[var(--primary)]"></i>
                         </div>
                        <h3 class="text-xl font-bold mb-2">Bắt đầu khám phá</h3>
                        <p class="text-[var(--text-color-muted)] max-w-sm">Hãy chọn một bộ phim từ danh sách bên cạnh để bắt đầu cuộc phiêu lưu của bạn!</p>
                    </div>

                    <div id="loading-content" class="p-10 flex justify-center items-center space-x-2 hidden">
                         <div class="dot animate-loader-dot" style="animation-delay: 0s;"></div>
                         <div class="dot animate-loader-dot" style="animation-delay: 0.1s;"></div>
                         <div class="dot animate-loader-dot" style="animation-delay: 0.2s;"></div>
                    </div>
                </div>
            </div>

        </div>
    </main>
    
     <footer class="mt-16 py-6 border-t border-[var(--border-color)] bg-transparent">
        <div class="w-full max-w-7xl mx-auto px-6 text-center text-sm text-[var(--text-color-muted)]">
            <p>© 2025 Aniplay. All content provided by the community.</p>
        </div>
    </footer>
    
    <script>
        
        document.addEventListener('DOMContentLoaded', () => {

            const siteHeader = document.getElementById('site-header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    siteHeader.classList.add('scrolled');
                } else {
                    siteHeader.classList.remove('scrolled');
                }
            });

            const themeToggle = document.getElementById('theme-toggle');
            const body = document.documentElement;

            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    body.classList.add('dark');
                    body.classList.remove('light');
                    themeToggle.checked = true;
                } else {
                    body.classList.remove('dark');
                    body.classList.add('light');
                    themeToggle.checked = false;
                }
            };
            
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                applyTheme(savedTheme);
            } else if (prefersDark) {
                applyTheme('dark');
            } else {
                 applyTheme('light');
            }
            

            themeToggle.addEventListener('change', function() {
                const theme = this.checked ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
                applyTheme(theme);
            });

            const scrollRevealObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    } else {
                        entry.target.classList.remove('visible');
                    }
                });
            }, {
                rootMargin: '0px 0px -50px 0px'
            });

            document.querySelectorAll('.scroll-reveal').forEach(el => scrollRevealObserver.observe(el));

            const ANIME_DATA_URL = 'https://raw.githubusercontent.com/yushichivnllc/sxhas/refs/heads/main/anime.csv';
            let animeData = {};
            let selectedAnimeName = null;
            let allAnimeList = [];

            const animeListContainer = document.getElementById('anime-list-container');
            const animeCountEl = document.getElementById('anime-count');
            const searchInput = document.getElementById('search-anime');
            const loadingAnimeEl = document.getElementById('loading-anime');
            
            const selectedAnimeInfoEl = document.getElementById('selected-anime-info');
            const selectedAnimeTitleEl = document.getElementById('selected-anime-title');
            const episodeCountEl = document.getElementById('episode-count');
            
            const episodeContainerEl = document.getElementById('episode-container');
            const episodeListEl = document.getElementById('episode-list');
            
            const playerContainerEl = document.getElementById('player-container');
            const videoPlayerEl = document.getElementById('video-player');

            const emptyStateEl = document.getElementById('empty-state');
            const loadingContentEl = document.getElementById('loading-content');
            
            const refreshBtn = document.getElementById('refresh-btn');

            const parseCSV = (text) => {
                const data = {};
                const list = [];
                const lines = text.split('\n').filter(line => line.trim() !== '');
                
                lines.slice(1).forEach(line => {
                    let inQuotes = false;
                    let value = '';
                    const values = [];
                    for(let i = 0; i < line.length; i++) {
                       if(line[i] === '"') inQuotes = !inQuotes;
                       else if(line[i] === ',' && !inQuotes) {
                         values.push(value.trim().replace(/^"|"$/g, ''));
                         value = '';
                       } else value += line[i];
                    }
                    values.push(value.trim().replace(/^"|"$/g, ''));

                    const name = values[0];
                    const episode = values[1];
                    const link = values[2];

                    if (name) {
                         if (!data[name]) {
                             data[name] = { name, episodes: [] };
                             list.push({name});
                         }
                         data[name].episodes.push({ episode, link });
                    }
                });
                return {data, list};
            };
            
            const renderAnimeList = (filterTerm = '') => {
                 while(animeListContainer.firstChild) animeListContainer.firstChild.remove();
                 
                let filteredList = filterTerm ? allAnimeList.filter(anime => anime.name.toLowerCase().includes(filterTerm.toLowerCase())) : allAnimeList;

                filteredList.sort((a,b) => a.name.localeCompare(b.name));

                 animeCountEl.textContent = filteredList.length;

                if(filteredList.length === 0) {
                     animeListContainer.innerHTML = `<div class="p-6 text-center text-[var(--text-color-muted)]">Không tìm thấy anime.</div>`;
                     return;
                }
                 
                const fragment = document.createDocumentFragment();
                filteredList.forEach(animeItem => {
                    const card = document.createElement('div');
                    card.className = `anime-card-dynamic relative p-4 rounded-xl cursor-pointer transition-all duration-300 transform-gpu hover:-translate-y-1 hover:shadow-2xl hover:shadow-[var(--primary)]/20`;
                    card.dataset.animeName = animeItem.name;
                    card.innerHTML = `
                         <div class="flex items-center justify-between">
                             <h3 class="font-bold text-[var(--text-color)] text-sm line-clamp-1">${animeItem.name}</h3>
                              <span class="text-xs font-semibold px-2 py-1 rounded-full bg-[var(--card-color-secondary)] text-[var(--text-color-muted)]">${animeData[animeItem.name].episodes.length} tập</span>
                         </div>`;
                    card.onclick = () => selectAnime(animeItem.name);
                    fragment.appendChild(card);
                });
                
                animeListContainer.appendChild(fragment);

                if (selectedAnimeName) {
                    updateActiveAnimeCard(selectedAnimeName);
                } else if (filteredList.length > 0) {
                    selectAnime(filteredList[0].name);
                }
            };

            const selectAnime = (animeName) => {
                 selectedAnimeName = animeName;
                 const anime = animeData[animeName];

                showLoadingState(true);

                 setTimeout(() => {
                     selectedAnimeTitleEl.textContent = anime.name;
                     episodeCountEl.textContent = anime.episodes.length;
                     
                     anime.episodes.sort((a, b) => (parseFloat(a.episode) || 0) - (parseFloat(b.episode) || 0));

                     let episodeHTML = '';
                     anime.episodes.forEach(ep => {
                          episodeHTML += `<div onclick="playEpisode('${encodeURIComponent(ep.link)}')" class="episode-button-glow p-2 text-sm text-center bg-gradient-to-r from-[var(--card-color-secondary)] to-[var(--bg-color)] text-[var(--text-color-muted)] hover:text-[var(--text-color)] border border-[var(--border-color)] transition-all cursor-pointer font-semibold rounded-lg">${ep.episode}</div>`
                     });
                     
                     episodeListEl.innerHTML = episodeHTML;
                     
                     emptyStateEl.style.display = 'none';
                     playerContainerEl.style.display = 'none';
                     videoPlayerEl.src = 'about:blank';
                     
                     selectedAnimeInfoEl.style.display = 'flex';
                     episodeContainerEl.style.display = 'block';

                     showLoadingState(false);
                 }, 300);

                 updateActiveAnimeCard(animeName);
            };

            const updateActiveAnimeCard = (animeName) => {
                 const allCards = animeListContainer.querySelectorAll('.anime-card-dynamic');
                 allCards.forEach(card => {
                    if(card.dataset.animeName === animeName) {
                       card.classList.add('ring-2', 'ring-[var(--primary-glow)]');
                       card.style.borderColor = 'transparent';
                    } else {
                        card.classList.remove('ring-2', 'ring-[var(--primary-glow)]');
                        card.style.borderColor = 'var(--border-color)';
                    }
                });
            }

             const playEpisode = (encodedLink) => {
                const link = decodeURIComponent(encodedLink);
                 playerContainerEl.style.display = 'block';

                let videoUrl = link.includes('drive.google.com') ? link.replace('/view', '/preview') : link;
                videoUrl = videoUrl.replace('http://', 'https://');
                
                videoPlayerEl.src = videoUrl;

                 const topPos = playerContainerEl.getBoundingClientRect().top + window.pageYOffset - 80;
                 window.scrollTo({top: topPos, behavior: 'smooth'});
            };
            
            const fetchAndInitialize = async () => {
                showLoadingState(true, true);
                try {
                    const res = await fetch(`${ANIME_DATA_URL}?v=${new Date().getTime()}`);
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    const text = await res.text();
                    const parsedData = parseCSV(text);
                    animeData = parsedData.data;
                    allAnimeList = parsedData.list;

                    setTimeout(() => { 
                         renderAnimeList();
                         if(allAnimeList.length > 0){
                           selectAnime(allAnimeList[0].name);
                           emptyStateEl.style.display = 'none';
                         } else {
                            showLoadingState(false);
                         }
                    }, 500);

                } catch (error) {
                    console.error("Failed to load data:", error);
                    animeListContainer.innerHTML = `<div class="p-4 text-center text-red-400">Không thể tải dữ liệu. Hãy thử làm mới.</div>`;
                    showLoadingState(false);
                }
            };
            
            const showLoadingState = (isLoading, isInitialLoad=false) => {
                if(isInitialLoad){
                     loadingAnimeEl.style.display = isLoading ? 'flex' : 'none';
                     emptyStateEl.style.display = 'block';
                     selectedAnimeInfoEl.style.display = 'none';
                     episodeContainerEl.style.display = 'none';
                     playerContainerEl.style.display = 'none';
                     
                } else if(isLoading) {
                     loadingContentEl.style.display = 'flex';
                     emptyStateEl.style.display = 'none';
                     selectedAnimeInfoEl.style.display = 'none';
                     episodeContainerEl.style.display = 'none';
                     playerContainerEl.style.display = 'none';
                 } else {
                    loadingContentEl.style.display = 'none';
                 }

            };

            searchInput.addEventListener('input', e => renderAnimeList(e.target.value.trim()));
            refreshBtn.addEventListener('click', () => { selectedAnimeName = null; fetchAndInitialize(); });
            window.selectAnime = selectAnime;
            window.playEpisode = playEpisode;

            fetchAndInitialize();
        });
        
    </script>
</body>
</html>
